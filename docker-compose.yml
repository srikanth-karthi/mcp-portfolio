version: '3.8'

services:
  # Node.js MCP Server
  mcp-portfolio-nodejs:
    build:
      context: .
      target: nodejs
    container_name: portfolio-mcp-nodejs
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - DATA_PATH=/app/sample-data.json
    stdin_open: true
    tty: true
    networks:
      - mcp-network

  # Python MCP Server
  mcp-portfolio-python:
    build:
      context: .
      target: python
    container_name: portfolio-mcp-python
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    networks:
      - mcp-network

  # Multi-runtime MCP Server (both Node.js and Python available)
  mcp-portfolio-multi:
    build:
      context: .
      target: multi
    container_name: portfolio-mcp-multi
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PYTHONUNBUFFERED=1
      - DATA_PATH=/app/sample-data.json
    stdin_open: true
    tty: true
    networks:
      - mcp-network
    # Override command to run Python instead of Node.js if desired
    # command: ["python3", "-m", "mcp_portfolio_server.server"]

networks:
  mcp-network:
    driver: bridge